# B2BPress - WordPress B2B电子商务解决方案

[English README](README.md)

B2BPress是一个基于WooCommerce的WordPress插件，专为B2B电子商务设计。它精简了WooCommerce的功能，并提供了强大的产品表格生成器，使您可以轻松创建和管理B2B产品目录，适用于需要大量产品表格展示。
![截图](/res/image/1.png)

## 主要功能

### WooCommerce "精简模式"
可选逐项关闭：购物车、收银台、优惠券、库存、价格、营销、结账、邮件模板、前端CSS/JS。

提供"向导"引导站点管理员，一键切换到B2B模式并自动检测与第三方插件冲突。

针对HPOS（High-Performance Order Storage）声明兼容，并在检测到旧版订单表结构时提醒升级。

### 产品表格生成器
向导式UI：

1. 选择产品分类
2. 读取该分类下所有属性（含全局属性、品牌等自定义taxonomy）
3. 多选+拖拽排序
4. 选择表格样式

数据列：产品名称（可点击进入单品页）、缩略图、SKU、自定义属性、多级分类、库存状态等。

支持分页、列排序、前端搜索、可选导出CSV。

三套预设外观（简洁、行条纹、卡片化）。

所有字符串可通过PO/MO翻译；表头支持RTL。

### 展示方式
短码：`[b2bpress_table id="123" style="striped" category="widgets" per_page="50"]`

Elementor小工具：在编辑面板显示实时预览；用户可直接新建/选择现有表格。

### 数据同步与缓存
监听产品变更钩子；若命中则使缓存失效。

缓存层级：对象缓存（wp_cache_set），键名含分类+属性哈希；瞬态缓存（set_transient）作为后备；站点启用Redis/Memcached时自动适配。

后台提供"立即刷新表格"按钮与WP-Cron定时重建。

### 权限与多角色
仅manage_woocommerce或自定义能力manage_b2bpress的用户可编辑表格。

可选前端"仅登录可见"与基于用户角色隐藏列。

### 开发者扩展点
动作钩子：b2bpress_table_before_render, b2bpress_table_after_render.

过滤器：b2bpress_column_value_$attribute_slug, b2bpress_table_styles.

REST API：/wp-json/b2bpress/v1/tables（CRUD），方便第三方前端或移动端调用。

## 系统要求

- WordPress 6.5+
- WooCommerce 8.7+
- PHP 8.0+

## 安装

1. 下载插件ZIP文件
2. 在WordPress后台进入"插件" > "安装插件"
3. 点击"上传插件"按钮，选择下载的ZIP文件
4. 安装完成后，激活插件
5. 进入"B2BPress" > "设置向导"，按照向导完成初始设置

## 使用方法

### 创建表格

1. 进入"B2BPress" > "表格管理"
2. 点击"添加表格"按钮
3. 输入表格标题，选择产品分类
4. 选择要显示的列，可以拖动排序
5. 选择表格样式
6. 点击"创建表格"按钮

### 在页面或文章中显示表格

使用短代码：

```
[b2bpress_table id="123"]
```

可选参数：

- `id`：表格ID（必填）
- `style`：表格样式（default、striped、card）
- `per_page`：每页显示的产品数量

### 在Elementor中使用

1. 编辑页面时，添加"B2B产品表格"小部件
2. 在小部件设置中选择表格
3. 根据需要调整表格样式和其他设置

## 支持

如果您有任何问题或需要帮助，请联系我们的支持团队。

## 许可证

GPL v2 或更高版本

## 更新日志

### 1.2.0 - 2025-08-14
- I18n：移除运行时英文映射，仅依赖 .po/.mo。后端跟随用户语言，前端跟随站点语言
- 设置：首次保存不再默认勾选全部选项；未出现的键保留旧值
- 体验：Elementor 小部件注册兼容新 API
- 性能：分类属性改为分页扫描；仅在后台/CRON/CLI 执行缓存清理
- 合规：补充 readme/license；优化后台文案与转义

### 1.1.1 - 2025-08-14
- I18n：后台页面英文适配；默认依赖 .po/.mo；运行时英文兜底可选（已在 1.2.0 中移除）
- 设置：首次保存不再默认勾选全部选项；保留未出现键的旧值
- 体验：前端统一按用户语言展示；Elementor 注册兼容新 API
- 性能：分类属性分页扫描；仅在后台/CRON/CLI 清理缓存
- 合规：补充 readme/license；优化后台文案及转义

### 1.1.0 - 2025-08-13
- 新增：全新表格样式集合（继承主题、ShadCN/UI、干净无边框、描边表格、紧凑密集），统一 CSS 选择器
- 修复：全局默认样式在前端不生效的问题（优先级与缓存清理）
- 新增：属性列支持前/后缀，保留空格并安全转义
- 新增：多语言前端优先使用用户偏好；增加英文兜底映射与 `languages/b2bpress-en_US.po`
- 体验：Elementor 小部件样式选项更新为新集合，移除重复控件避免冲突

### 1.0.1 - 2025-08-11
- 修复：移除重复的全局激活/停用钩子，避免重复执行激活逻辑
- 安全：表格单元格输出增加转义与 HTML 白名单，降低 XSS 风险
- 性能/稳定：缓存清理不再使用全站对象缓存 flush，改为精确按前缀/组删除
- 体验：表头与分页增加可访问性属性；预渲染表格输出更安全

### 1.0.0 - 2025-08-11
- 首次发布
- WooCommerce 精简模式（可配置关闭购物车/收银台/优惠券/库存/价格/营销/结账/邮件模板/前端CSS与JS）
- 产品表格生成器（向导式配置，多列/排序，分页，搜索，可选CSV导出）
- Elementor 小工具（编辑面板实时预览，支持新建/选择表格）
- 缓存与同步（对象缓存与瞬态缓存、WP-Cron 定时重建、后台一键刷新）
- 权限与可见性（仅管理能力可编辑，前端登录可见与基于角色隐藏列）
- 开发者扩展点（动作钩子与过滤器）
- REST API `/wp-json/b2bpress/v1/tables`（CRUD）
- HPOS 兼容声明

